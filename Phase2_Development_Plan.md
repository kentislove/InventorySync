# 第二階段：即時庫存查詢系統 - 開發計畫草案 (修訂版)

## 1. 專案目標
建立一個針對特定商品的快速庫存查詢網頁。此系統利用第一階段建立的「本地資料庫」作為產品清單基準，即時向三平台 API 查詢最新庫存並呈現，**不執行**庫存寫回 (Sync) 動作。

## 2. 核心原則
*   **精準查詢**：不進行全賣場下載，僅針對本地資料庫中已存在的有效商品進行 API 庫存查詢。
*   **即時呈現**：網頁輸入 SKU 後，即時抓取三平台最新庫存數。
*   **純查詢模式**：僅提供資訊查詢，不涉及庫存修改或同步回寫。

## 3. 功能架構

### A. 資料來源與範圍 (Data Scope)
*   **基準清單**：讀取 `inventory.db` (由第一階段排程每日更新)。
*   **有效範圍**：鎖定 `Status = Active` 且 `EndTs >= Today` 的商品。
*   **運作方式**：系統啟動時載入有效商品清單 (SKU List)，作為 API 查詢的依據。

### B. 網頁呈現 (Web Interface)
*   **輸入**：提供一個搜尋框，供使用者輸入「產品編號 (SKU)」。
*   **輸出**：顯示該 SKU 在三個平台 (Yahoo, Momo, PChome) 的即時庫存數量。
*   **流程**：
    1.  使用者輸入 SKU。
    2.  系統確認該 SKU 存在於本地有效清單中。
    3.  系統同時呼叫三平台 API (Get Stock)，僅查詢該單一 SKU 的庫存。
    4.  網頁顯示查詢結果。

### C. 批量快速更新 (Batch Quick Sync)
*   **需求**：每 10 分鐘執行一次全量庫存更新。
*   **可行性評估**：
    *   **Yahoo (13,000 件)**：使用 List API (50筆/頁) 僅需約 260 次請求。若每秒處理 2 頁，約 2-3 分鐘可完成。
    *   **PChome (2,000 件) & Momo (1,000 件)**：數量較少，約 1 分鐘內可完成。
    *   **總耗時預估**：< 5 分鐘 (安全範圍內)。
*   **關鍵策略**：
    *   **僅更新庫存**：不檢查 `endTs` (由第一階段負責)，不下載詳細資料。
    *   **資料寫回**：將最新的庫存數量寫入 **本地資料庫** 與 **Google Sheets (GS)**，確保資料一致性。

### D. 系統邊界 (System Boundaries)
*   **不執行**：全賣場商品下載 (由第一階段負責)。
*   **不執行**：`endTs` 過期檢查 (耗時，由第一階段負責)。
*   **不執行**：庫存寫回/同步 (Sync) 動作 (指寫回平台，除非使用者手動觸發)。
*   **執行**：將查詢到的最新庫存寫入本地 DB 與 GS。

## 4. 開發步驟 (Roadmap)

1.  **建立資料庫讀取模組**
    *   開發 `db_reader.py`，用於讀取 `inventory.db` 並產生有效 SKU 清單。
2.  **開發快速庫存抓取模組 (Quick Fetcher)**
    *   實作 `YahooQuickFetcher`, `MomoQuickFetcher` 等，專注於使用 List API 快速取得 `SKU: Stock` 對照表。
3.  **開發網頁後端**
    *   建立 `server.py`，提供 API 查詢與背景排程執行快速更新。
4.  **整合前端網頁**
    *   設計搜尋介面與最後更新時間顯示。
5.  **封包與部署**
    *   產出 `InventoryQuery_System.exe`。

## 5. 預期效益
*   **精準快速**：僅查詢單一商品，回應速度極快。
*   **資訊即時**：直接從 API 取得最新當下庫存，非歷史資料。
*   **安全單純**：不涉及寫入操作，無資料汙染風險。
